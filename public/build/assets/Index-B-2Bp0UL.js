import{d as W,r as _,w as G,a as K,c as d,b as t,u as e,h as Y,e as l,f as i,o as a,t as u,g as P,i as n,F as L,j as B,k as h,n as E,l as Z,m as D}from"./app-EW944B-L.js";import{i as O,s as T,_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cjrr-dwK.js";import{r as te,d as se,_ as le}from"./index-CDe0eL9-.js";import{_ as re,a as oe,b as ae,c as ne}from"./DialogTitle.vue_vue_type_script_setup_true_lang-DsXqMRD4.js";import{_ as ie}from"./Input.vue_vue_type_script_setup_true_lang-CHFtY4OJ.js";import{_ as M,a as R,b as w,c,d as U,e as p}from"./TableRow.vue_vue_type_script_setup_true_lang-C0howyu3.js";import{_ as ue}from"./Pagination.vue_vue_type_script_setup_true_lang-BUcTPIA-.js";import{S as de}from"./search-IMbWRnS7.js";import{C as me}from"./copy-CF9I0Hjf.js";import{B as fe}from"./box-BqGP_FV7.js";import{E as ce}from"./external-link-DfHAzwr4.js";import{C as pe}from"./users-wNylPA22.js";import{L as xe}from"./loader-circle-DaLkSE__.js";import"./index-st2w8MOo.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-C_fT3f4S.js";import"./useForwardPropsEmits-BISw5jdW.js";import"./useForwardExpose-N368YyX0.js";import"./PopperContent-Bw2xTC76.js";import"./Collection-CKV9oJ_8.js";import"./Teleport-C5MOIu1E.js";import"./createLucideIcon-CwEg02G-.js";import"./VisuallyHidden-C1YE6-f1.js";import"./index-D0yXrzw6.js";import"./useTypeahead-DqKebK74.js";import"./RovingFocusGroup-DKz84A0x.js";import"./utils-C5Kk41sG.js";import"./chevrons-up-down-DO-okxmT.js";import"./SheetDescription.vue_vue_type_script_setup_true_lang-OKQ-W-U0.js";import"./user-CJweOFfh.js";import"./file-text-DDs5lqFG.js";import"./thumbs-up-Jl6xrrri.js";import"./chevron-left-DQNf75Vw.js";const _e={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},ge={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},ve={class:"relative flex-1 sm:max-w-sm"},be={key:0,class:"text-sm text-muted-foreground"},ye={key:0,class:"rounded-md border"},he={key:0},we={key:1},ke=["title","onClick"],Ce={class:"truncate"},$e={key:1},je={key:1,class:"flex flex-col items-center justify-center rounded-xl border border-dashed py-12"},Ve={class:"text-center text-sm text-muted-foreground"},Se={class:"mt-2 max-h-[420px] overflow-auto"},Le={key:0,class:"flex items-center justify-center gap-2 py-12 text-muted-foreground"},Ae={key:2,class:"py-8 text-center text-sm text-muted-foreground"},ut=W({__name:"Index",props:{activities:{},filters:{default:()=>({search:"",log_name:""})}},setup(m){const A=m,k=_(A.filters.search??""),q=te(k,300),C=_(null);let $=null;const j=_(!1),g=_(null),V=_(!1),v=_(null);let x=null;function F(r){return`${T(r).url}/properties`}async function I(r){x&&(x.abort(),x=null),v.value=r.id,g.value=null,V.value=!0,j.value=!0,x=new AbortController;try{const s=await fetch(F(r.id),{signal:x.signal,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)return;const o=await s.json();v.value===r.id&&(g.value=o.properties??{})}catch{v.value===r.id&&(g.value={})}finally{v.value===r.id&&(V.value=!1),x=null}}function N(r){return r==null?"—":typeof r=="object"?JSON.stringify(r):String(r)}const z=D(()=>{const r=g.value;if(!r||typeof r!="object")return[];const s=r.attributes??{},o=r.old??{},y=new Set([...Object.keys(s),...Object.keys(o)]);return y.size>0?[...y].sort().map(f=>({property:f,oldValue:o[f],newValue:s[f]})):Object.entries(r).filter(([f])=>f!=="attributes"&&f!=="old").sort(([f],[S])=>f.localeCompare(S)).map(([f,S])=>({property:f,oldValue:void 0,newValue:S}))}),X=D(()=>z.value.length>0);async function H(r){try{await navigator.clipboard.writeText(r),C.value=r,$&&clearTimeout($),$=setTimeout(()=>{C.value=null},1500)}catch{}}G(q,r=>{K.get(O().url,{search:r||void 0,log_name:A.filters.log_name||void 0},{preserveState:!0,preserveScroll:!0,replace:!0})});function J(r){return new Date(r).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})}function b(r){return r?r==="created"?"default":r==="updated"?"outline":r==="deleted"?"destructive":"secondary":"secondary"}const Q=[{title:"Dashboard",href:se().url},{title:"Activity Log",href:O().url}];return(r,s)=>(a(),d(L,null,[t(e(Y),{title:"Activity Log"}),t(ee,{breadcrumbs:Q},{default:l(()=>[i("div",_e,[s[15]||(s[15]=i("div",{class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[i("div",null,[i("h1",{class:"text-2xl font-semibold tracking-tight"}," Activity Log "),i("p",{class:"text-muted-foreground"}," Audit trail of model changes (super admin only) ")])],-1)),i("div",ge,[i("div",ve,[t(e(de),{class:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),t(e(ie),{modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=o=>k.value=o),type:"search",placeholder:"Search description, subject, event...",class:"pl-9"},null,8,["modelValue"])]),m.activities.total>0?(a(),d("p",be," Showing "+u(m.activities.from)+"–"+u(m.activities.to)+" of "+u(m.activities.total),1)):P("",!0)]),m.activities.data.length>0?(a(),d("div",ye,[t(e(M),null,{default:l(()=>[t(e(R),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(c),{class:"w-[140px]"},{default:l(()=>[...s[2]||(s[2]=[n("Date",-1)])]),_:1}),t(e(c),{class:"w-[90px]"},{default:l(()=>[...s[3]||(s[3]=[n("Event",-1)])]),_:1}),t(e(c),{class:"w-[120px]"},{default:l(()=>[...s[4]||(s[4]=[n("Subject",-1)])]),_:1}),t(e(c),{class:"w-[180px]"},{default:l(()=>[...s[5]||(s[5]=[n("Causer email",-1)])]),_:1}),t(e(c),{class:"w-[80px]"},{default:l(()=>[...s[6]||(s[6]=[n("Log",-1)])]),_:1}),t(e(c),{class:"w-[160px]"})]),_:1})]),_:1}),t(e(U),null,{default:l(()=>[(a(!0),d(L,null,B(m.activities.data,o=>(a(),h(e(w),{key:o.id},{default:l(()=>[t(e(p),{class:"text-muted-foreground text-sm whitespace-nowrap"},{default:l(()=>[n(u(J(o.created_at)),1)]),_:2},1024),t(e(p),null,{default:l(()=>[i("span",{class:E(["inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium",b(o.event)==="default"&&"bg-primary text-primary-foreground",b(o.event)==="outline"&&"border border-input bg-background",b(o.event)==="destructive"&&"bg-destructive/10 text-destructive",b(o.event)==="secondary"&&"bg-muted text-muted-foreground"])},u(o.event??"—"),3)]),_:2},1024),t(e(p),{class:"text-muted-foreground text-sm"},{default:l(()=>[o.subject_type?(a(),d("span",he,u(o.subject_type)+" #"+u(o.subject_id),1)):(a(),d("span",we,"—"))]),_:2},1024),t(e(p),{class:"text-muted-foreground text-sm"},{default:l(()=>[o.causer_email?(a(),d("span",{key:0,class:"group flex cursor-pointer items-center gap-1.5 rounded px-1.5 py-0.5 transition-colors hover:bg-muted/80",title:`Copy ${o.causer_email}`,onClick:y=>H(o.causer_email)},[i("span",Ce,u(o.causer_email),1),t(e(me),{class:E(["size-3.5 shrink-0 opacity-60 group-hover:opacity-100",{"text-green-600 dark:text-green-400":C.value===o.causer_email}])},null,8,["class"])],8,ke)):(a(),d("span",$e,"—"))]),_:2},1024),t(e(p),{class:"text-muted-foreground text-xs"},{default:l(()=>[n(u(o.log_name??"default"),1)]),_:2},1024),t(e(p),{class:"flex items-center gap-2"},{default:l(()=>[t(e(le),{variant:"ghost",size:"sm",class:"h-8 gap-1",onClick:y=>I(o)},{default:l(()=>[t(e(fe),{class:"size-3.5"}),s[7]||(s[7]=n(" Properties ",-1))]),_:1},8,["onClick"]),t(e(Z),{href:e(T)(o.id).url,class:"inline-flex items-center gap-1 text-sm text-primary hover:underline"},{default:l(()=>[s[8]||(s[8]=n(" View ",-1)),t(e(ce),{class:"size-3.5"})]),_:1},8,["href"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(a(),d("div",je,[t(e(pe),{class:"mb-4 h-12 w-12 text-muted-foreground"}),s[9]||(s[9]=i("h3",{class:"mb-2 text-lg font-semibold"},"No activity yet",-1)),i("p",Ve,u(m.filters.search??""?"No entries match your search.":"Activity will appear here as models are changed."),1)])),m.activities.links?.length?(a(),h(ue,{key:2,links:m.activities.links},null,8,["links"])):P("",!0),t(e(re),{open:j.value,"onUpdate:open":s[1]||(s[1]=o=>j.value=o)},{default:l(()=>[t(e(oe),{class:"sm:max-w-2xl"},{default:l(()=>[t(e(ae),null,{default:l(()=>[t(e(ne),null,{default:l(()=>[...s[10]||(s[10]=[n(" Properties (attributes / old values) ",-1)])]),_:1})]),_:1}),i("div",Se,[V.value?(a(),d("div",Le,[t(e(xe),{class:"size-5 animate-spin"}),s[11]||(s[11]=i("span",null,"Loading…",-1))])):X.value?(a(),h(e(M),{key:1},{default:l(()=>[t(e(R),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(c),{class:"w-[140px]"},{default:l(()=>[...s[12]||(s[12]=[n("Property",-1)])]),_:1}),t(e(c),null,{default:l(()=>[...s[13]||(s[13]=[n("Old value",-1)])]),_:1}),t(e(c),null,{default:l(()=>[...s[14]||(s[14]=[n("New value",-1)])]),_:1})]),_:1})]),_:1}),t(e(U),null,{default:l(()=>[(a(!0),d(L,null,B(z.value,o=>(a(),h(e(w),{key:o.property},{default:l(()=>[t(e(p),{class:"font-medium"},{default:l(()=>[n(u(o.property),1)]),_:2},1024),t(e(p),{class:"font-mono text-muted-foreground text-xs"},{default:l(()=>[n(u(N(o.oldValue)),1)]),_:2},1024),t(e(p),{class:"font-mono text-xs"},{default:l(()=>[n(u(N(o.newValue)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(a(),d("p",Ae," No properties recorded for this activity. "))])]),_:1})]),_:1},8,["open"])])]),_:1})],64))}});export{ut as default};
