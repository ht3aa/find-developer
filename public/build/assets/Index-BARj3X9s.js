import{d as W,r as _,w as G,a as K,c as d,b as t,u as e,h as Y,e as l,f as i,o,t as u,g as P,i as n,F as L,j as B,k as h,n as E,l as Z,m as D}from"./app-CRw3-p0n.js";import{i as O,s as T,_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-CKM9mFgs.js";import{r as te,d as se,_ as le}from"./index-YUdjfNlU.js";import{_ as re,a as ae,b as oe,c as ne}from"./DialogTitle.vue_vue_type_script_setup_true_lang-w8eS1DaL.js";import{_ as ie}from"./Input.vue_vue_type_script_setup_true_lang-BJjXe5FR.js";import{_ as M,a as R,b as w,c,d as U,e as p}from"./TableRow.vue_vue_type_script_setup_true_lang-0rAJcHu9.js";import{_ as ue}from"./Pagination.vue_vue_type_script_setup_true_lang-ai2igeTO.js";import{S as de}from"./search-BXAk_-8k.js";import{C as fe}from"./copy-D9tAGfdR.js";import{B as me}from"./box-Ctk4vRBt.js";import{E as ce}from"./external-link-CRIhThdP.js";import{C as pe}from"./users-BJvktpYV.js";import{L as xe}from"./loader-circle-CypqLPbx.js";import"./index-CxyJPG2X.js";import"./TooltipTrigger.vue_vue_type_script_setup_true_lang-B7YQwo9Z.js";import"./createLucideIcon-CZ3KoMzD.js";import"./useForwardPropsEmits-DZbuhTEu.js";import"./useForwardExpose-BJkOkH-4.js";import"./PopperContent-BL2ktdEK.js";import"./Collection-uSGNX8c4.js";import"./Teleport-DQ513N3r.js";import"./VisuallyHidden-wTvmLbDE.js";import"./index-D6k88Q50.js";import"./useTypeahead-ai5RrIpQ.js";import"./RovingFocusGroup-HdiJtpdt.js";import"./utils-Dwb1dSJa.js";import"./chevrons-up-down-D3DlT39k.js";import"./SheetDescription.vue_vue_type_script_setup_true_lang-DaJ1geIF.js";import"./user-5lurQomp.js";import"./thumbs-up-CtdE1A4C.js";import"./chevron-left-uIKLg0GP.js";const _e={class:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4"},ge={class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},ve={class:"relative flex-1 sm:max-w-sm"},be={key:0,class:"text-sm text-muted-foreground"},ye={key:0,class:"rounded-md border"},he={key:0},we={key:1},ke=["title","onClick"],Ce={class:"truncate"},$e={key:1},je={key:1,class:"flex flex-col items-center justify-center rounded-xl border border-dashed py-12"},Ve={class:"text-center text-sm text-muted-foreground"},Se={class:"mt-2 max-h-[420px] overflow-auto"},Le={key:0,class:"flex items-center justify-center gap-2 py-12 text-muted-foreground"},Ae={key:2,class:"py-8 text-center text-sm text-muted-foreground"},it=W({__name:"Index",props:{activities:{},filters:{default:()=>({search:"",log_name:""})}},setup(f){const A=f,k=_(A.filters.search??""),q=te(k,300),C=_(null);let $=null;const j=_(!1),g=_(null),V=_(!1),v=_(null);let x=null;function F(r){return`${T(r).url}/properties`}async function I(r){x&&(x.abort(),x=null),v.value=r.id,g.value=null,V.value=!0,j.value=!0,x=new AbortController;try{const s=await fetch(F(r.id),{signal:x.signal,headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!s.ok)return;const a=await s.json();v.value===r.id&&(g.value=a.properties??{})}catch{v.value===r.id&&(g.value={})}finally{v.value===r.id&&(V.value=!1),x=null}}function N(r){return r==null?"—":typeof r=="object"?JSON.stringify(r):String(r)}const z=D(()=>{const r=g.value;if(!r||typeof r!="object")return[];const s=r.attributes??{},a=r.old??{},y=new Set([...Object.keys(s),...Object.keys(a)]);return y.size>0?[...y].sort().map(m=>({property:m,oldValue:a[m],newValue:s[m]})):Object.entries(r).filter(([m])=>m!=="attributes"&&m!=="old").sort(([m],[S])=>m.localeCompare(S)).map(([m,S])=>({property:m,oldValue:void 0,newValue:S}))}),X=D(()=>z.value.length>0);async function H(r){try{await navigator.clipboard.writeText(r),C.value=r,$&&clearTimeout($),$=setTimeout(()=>{C.value=null},1500)}catch{}}G(q,r=>{K.get(O().url,{search:r||void 0,log_name:A.filters.log_name||void 0},{preserveState:!0,preserveScroll:!0,replace:!0})});function J(r){return new Date(r).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})}function b(r){return r?r==="created"?"default":r==="updated"?"outline":r==="deleted"?"destructive":"secondary":"secondary"}const Q=[{title:"Dashboard",href:se().url},{title:"Activity Log",href:O().url}];return(r,s)=>(o(),d(L,null,[t(e(Y),{title:"Activity Log"}),t(ee,{breadcrumbs:Q},{default:l(()=>[i("div",_e,[s[15]||(s[15]=i("div",{class:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"},[i("div",null,[i("h1",{class:"text-2xl font-semibold tracking-tight"}," Activity Log "),i("p",{class:"text-muted-foreground"}," Audit trail of model changes (super admin only) ")])],-1)),i("div",ge,[i("div",ve,[t(e(de),{class:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),t(e(ie),{modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=a=>k.value=a),type:"search",placeholder:"Search description, subject, event...",class:"pl-9"},null,8,["modelValue"])]),f.activities.total>0?(o(),d("p",be," Showing "+u(f.activities.from)+"–"+u(f.activities.to)+" of "+u(f.activities.total),1)):P("",!0)]),f.activities.data.length>0?(o(),d("div",ye,[t(e(M),null,{default:l(()=>[t(e(R),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(c),{class:"w-[140px]"},{default:l(()=>[...s[2]||(s[2]=[n("Date",-1)])]),_:1}),t(e(c),{class:"w-[90px]"},{default:l(()=>[...s[3]||(s[3]=[n("Event",-1)])]),_:1}),t(e(c),{class:"w-[120px]"},{default:l(()=>[...s[4]||(s[4]=[n("Subject",-1)])]),_:1}),t(e(c),{class:"w-[180px]"},{default:l(()=>[...s[5]||(s[5]=[n("Causer email",-1)])]),_:1}),t(e(c),{class:"w-[80px]"},{default:l(()=>[...s[6]||(s[6]=[n("Log",-1)])]),_:1}),t(e(c),{class:"w-[160px]"})]),_:1})]),_:1}),t(e(U),null,{default:l(()=>[(o(!0),d(L,null,B(f.activities.data,a=>(o(),h(e(w),{key:a.id},{default:l(()=>[t(e(p),{class:"text-muted-foreground text-sm whitespace-nowrap"},{default:l(()=>[n(u(J(a.created_at)),1)]),_:2},1024),t(e(p),null,{default:l(()=>[i("span",{class:E(["inline-flex items-center rounded-md px-2 py-0.5 text-xs font-medium",b(a.event)==="default"&&"bg-primary text-primary-foreground",b(a.event)==="outline"&&"border border-input bg-background",b(a.event)==="destructive"&&"bg-destructive/10 text-destructive",b(a.event)==="secondary"&&"bg-muted text-muted-foreground"])},u(a.event??"—"),3)]),_:2},1024),t(e(p),{class:"text-muted-foreground text-sm"},{default:l(()=>[a.subject_type?(o(),d("span",he,u(a.subject_type)+" #"+u(a.subject_id),1)):(o(),d("span",we,"—"))]),_:2},1024),t(e(p),{class:"text-muted-foreground text-sm"},{default:l(()=>[a.causer_email?(o(),d("span",{key:0,class:"group flex cursor-pointer items-center gap-1.5 rounded px-1.5 py-0.5 transition-colors hover:bg-muted/80",title:`Copy ${a.causer_email}`,onClick:y=>H(a.causer_email)},[i("span",Ce,u(a.causer_email),1),t(e(fe),{class:E(["size-3.5 shrink-0 opacity-60 group-hover:opacity-100",{"text-green-600 dark:text-green-400":C.value===a.causer_email}])},null,8,["class"])],8,ke)):(o(),d("span",$e,"—"))]),_:2},1024),t(e(p),{class:"text-muted-foreground text-xs"},{default:l(()=>[n(u(a.log_name??"default"),1)]),_:2},1024),t(e(p),{class:"flex items-center gap-2"},{default:l(()=>[t(e(le),{variant:"ghost",size:"sm",class:"h-8 gap-1",onClick:y=>I(a)},{default:l(()=>[t(e(me),{class:"size-3.5"}),s[7]||(s[7]=n(" Properties ",-1))]),_:1},8,["onClick"]),t(e(Z),{href:e(T)(a.id).url,class:"inline-flex items-center gap-1 text-sm text-primary hover:underline"},{default:l(()=>[s[8]||(s[8]=n(" View ",-1)),t(e(ce),{class:"size-3.5"})]),_:1},8,["href"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):(o(),d("div",je,[t(e(pe),{class:"mb-4 h-12 w-12 text-muted-foreground"}),s[9]||(s[9]=i("h3",{class:"mb-2 text-lg font-semibold"},"No activity yet",-1)),i("p",Ve,u(f.filters.search??""?"No entries match your search.":"Activity will appear here as models are changed."),1)])),f.activities.links?.length?(o(),h(ue,{key:2,links:f.activities.links},null,8,["links"])):P("",!0),t(e(re),{open:j.value,"onUpdate:open":s[1]||(s[1]=a=>j.value=a)},{default:l(()=>[t(e(ae),{class:"sm:max-w-2xl"},{default:l(()=>[t(e(oe),null,{default:l(()=>[t(e(ne),null,{default:l(()=>[...s[10]||(s[10]=[n(" Properties (attributes / old values) ",-1)])]),_:1})]),_:1}),i("div",Se,[V.value?(o(),d("div",Le,[t(e(xe),{class:"size-5 animate-spin"}),s[11]||(s[11]=i("span",null,"Loading…",-1))])):X.value?(o(),h(e(M),{key:1},{default:l(()=>[t(e(R),null,{default:l(()=>[t(e(w),null,{default:l(()=>[t(e(c),{class:"w-[140px]"},{default:l(()=>[...s[12]||(s[12]=[n("Property",-1)])]),_:1}),t(e(c),null,{default:l(()=>[...s[13]||(s[13]=[n("Old value",-1)])]),_:1}),t(e(c),null,{default:l(()=>[...s[14]||(s[14]=[n("New value",-1)])]),_:1})]),_:1})]),_:1}),t(e(U),null,{default:l(()=>[(o(!0),d(L,null,B(z.value,a=>(o(),h(e(w),{key:a.property},{default:l(()=>[t(e(p),{class:"font-medium"},{default:l(()=>[n(u(a.property),1)]),_:2},1024),t(e(p),{class:"font-mono text-muted-foreground text-xs"},{default:l(()=>[n(u(N(a.oldValue)),1)]),_:2},1024),t(e(p),{class:"font-mono text-xs"},{default:l(()=>[n(u(N(a.newValue)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(o(),d("p",Ae," No properties recorded for this activity. "))])]),_:1})]),_:1},8,["open"])])]),_:1})],64))}});export{it as default};
